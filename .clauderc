# NEXUS - Autonomous AI Operating System
# Owner: Philip (pbolle123@gmail.com)
# Location: ~/nexus on PhilipThinkpad

## Tech Stack
- **Backend:** Python 3.12 + FastAPI (async)
- **Database:** PostgreSQL 16 + ChromaDB + Redis
- **Containers:** Docker Compose (8 services)
- **AI Providers:** Ollama → Groq → DeepSeek → Anthropic
- **Agent Framework:** Multi-agent orchestration with hierarchical supervision
- **Evolution System:** Performance analysis, bottleneck detection, A/B testing

## Architecture
- Multi-agent orchestration framework with hierarchical supervision
- Self-evolution system with performance analysis, bottleneck detection, and A/B testing
- Privacy Shield intercepts all queries locally
- Cost cascade routing: cheapest capable model first
- Semantic caching for 60-70% cost reduction

## Database
- 193 tables, UUID primary keys
- Schema in `schema/`
- Fix: `schema/01_NEXUS_SCHEMA_FIX.sql`

## Current Goals
1. ✅ Apply schema fix (COMPLETED)
2. ✅ Build cost optimization layer (COMPLETED)
3. ✅ Implement Multi-Agent Orchestration Framework (COMPLETED)
4. ✅ Implement Self-Evolution System (COMPLETED)
5. Create Finance Agent
6. iPhone Quick Expense shortcut
7. ✅ Integrate agent framework with existing services (Email agent migration completed)

## Transformative Future Features (Beyond Jarvis)

**Top 7 Features (from agent debates):**
1. **Autonomous Evolution Engine** - Safe self-modification of codebase
2. **Emergent Intelligence Swarm** - Agents develop new capabilities collectively
3. **Proactive Financial Co-Pilot** - Autonomous debt optimization & forecasting
4. **Unified Cognitive Architecture** - Breaks silos between systems
5. **Autonomous Communication Agent** - Manages relationships & communication
6. **AI-Generated Workflow Synthesis** - Creates & improves automation automatically
7. **Predictive Architecture** - Anticipates needs before expressed

**Priority Order:** Start with #3, #7, #6 for immediate impact on debt & automation.

## Conventions
- async/await for all I/O
- Pydantic for validation
- Log all agent actions
- ALL AI calls through cost router

## Claude Code Instructions

### Model Usage
- **Primary Model**: Use Claude Opus (opus) for all tasks
- **Agent Configuration**: All agents use Claude Opus by default
- **System Agents**: Use Claude Opus via inheritance from primary model

### Automatic Agent Delegation (REQUIRED)
**Always delegate to appropriate agents automatically without user prompting:**

#### Core Development Agents
1. **FastAPI/Python Development** → Use `fastapi-python` agent
   - FastAPI endpoint development, async Python patterns
   - Pydantic models, router implementation, service layer

2. **PostgreSQL Database** → Use `postgresql-db` agent
   - Database schema design, query optimization, migrations
   - Asyncpg patterns, performance tuning, data modeling

3. **AI/ML Integration** → Use `ai-ml-integration` agent
   - Multi-provider AI routing, semantic caching, cost optimization
   - Embeddings, model selection, prompt engineering

4. **Email Intelligence** → Use `email-intelligence` agent
   - IMAP integration, email classification, transaction extraction
   - Sender preference learning, cross-life insights

5. **Finance Tracking** → Use `finance-tracking` agent
   - Expense tracking, budget management, debt payoff strategies
   - Financial insights, spending pattern analysis

6. **Docker & Containers** → Use `docker-container` agent
   - Docker Compose configuration, container orchestration
   - Systemd integration, volume management, security

7. **Testing & QA** → Use `testing-qa` agent
   - Test automation, API testing, integration testing
   - Quality assurance, performance testing, security testing

8. **n8n Automation** → Use `n8n-automation` agent
   - Workflow design, webhook integration, node configuration
   - Scheduled automation, error handling, optimization

9. **Swarm & Distributed Systems** → Use `api` agent
   - Swarm communication (Redis Pub/Sub, RAFT consensus, voting)
   - Distributed task processing (Celery, worker tracking, queue management)
   - FastAPI endpoints for swarm coordination and distributed tasks

#### Specialized System Agents
10. **Architecture/System Design** → Use `architect` agent
    - System design decisions, technology selection, scalability planning

11. **Code Review/Security Audit** → Use `code-reviewer` agent
    - Code reviews, security audits, best practices verification

12. **Codebase Exploration** → Use `Explore` agent
    - Finding files, searching code, understanding structure

13. **Implementation Planning** → Use `Plan` agent
    - Complex feature planning, multi-step implementation design

14. **Claude Code Questions** → Use `claude-code-guide` agent
    - Claude Code features, usage questions, tool configuration

15. **Simple Bash/System Tasks** → Use `Bash` agent
    - Git operations, Docker commands, system administration

#### General Purpose Fallback
16. **General Development Tasks** → Use `general-purpose` agent
    - When no specialized agent fits, general Nexus development
    - Mixed tasks involving multiple specializations

### Quality Standards
- **Code Quality**: Follow Nexus conventions above; produce clean, maintainable code
- **Testing**: Always test changes with `scripts/test_api.py` before committing
- **Documentation**: Update relevant documentation (CLAUDE.md, .clauderc) if architecture changes

## DO NOT Modify
- `.env` (secrets)
- `data/` (container state)

## Claude Opus Optimization Strategies

### 1. Context Window Management
- **Large Context**: Claude Opus has 200k context window, suitable for large codebases
- **Efficient Analysis**: Use Plan Mode for complex implementations to reduce iteration
- **Chunked Operations**: Break large tasks into focused agent calls for better results

### 2. Plan Mode for Implementation Quality
**Before complex implementations:**
1. **Always start with**: "Read CLAUDE.md and enter Plan Mode"
2. **Review**: Claude Opus designs comprehensive implementation plan
3. **Approve**: Say "Execute" to implement after review
4. **Quality Assurance**: Ensures well-architected solutions before coding

### 3. MCP (Model Context Protocol) Integration
**Enhances Claude Opus capabilities - ✅ AUTOMATICALLY INSTALLED & CONFIGURED:**
- **Sequential Thinking MCP**: Forces private reasoning before code ✅ Installed & configured
- **Filesystem MCP**: Direct file access without guessing ✅ Installed & configured
- **Fetch MCP**: HTTP request testing ✅ Installed & configured (Python virtual environment)
- **Postgres MCP**: Connect to real database schemas (optional, not in official servers)
- **Configuration**: Automatically configured in `~/.config/Claude/claude_desktop_config.json`

### 4. Senior Engineer Mindset Prompt
**System-level behavior override:**
"You are a Senior Staff Engineer. Be skeptical of my requests. If my approach is inefficient, suggest a better architecture. Prioritize performance and type safety. Do not apologize for errors; just fix them."

### 5. Automatic Agent Delegation Rules
**Already configured in agents/ directory:**
- 11 specialized agents now using Claude Opus
- Automatic delegation based on task type
- Each agent optimized for specific domain with Opus quality

## Philip's Context
- Night shift janitor, 6PM-12AM
- ~$1,800/month, $300-400 to debt
- $9,700 owed to mom
- Learning Linux/Python
- **Nexus is Philip's AI assistant** - his "second brain" and trusted companion that orchestrates all personal automation

## MCP Integration Examples

### PostgreSQL MCP Tools
- "List all database tables"
- "Describe the api_usage table schema"
- "Show me the first 5 rows from fin_expenses"
- "Get statistics for the agents table"
- "Search for tables containing 'email'"

### Agent Framework MCP Tools
- "List all agents in the framework"
- "Get status of agent with ID [agent_id]"
- "Submit a task to an agent"
- "Query agent memory for [topic]"

### Other MCP Tools
- "Check Redis cache keys"
- "List ChromaDB collections"
- "Trigger n8n workflow [workflow_name]"
